# /config/packages/31_zaehler_haus_wp_strom.yaml
# Haus – Wärmepumpe: Strom (jahresneutral)

utility_meter:
  haus_strom_wp_kwh_year:
    name: "Haus – WP Strom: Jahr"
    source: sensor.zaehler_xiao_c6_wp_zahlerstand_gesamt_kwh   # ← Quelle bei dir vorhanden
    cycle: yearly

input_number:
  haus_strom_wp_vormontage_kwh:
    name: "Haus – WP Strom: Vormontage [kWh]"
    min: 0
    max: 100000
    step: 0.1
    mode: box
    unit_of_measurement: "kWh"

template:
  - sensor:
      - name: haus_strom_wp_kwh_gesamt
        unique_id: haus_strom_wp_kwh_gesamt
        device_class: energy
        state_class: total
        unit_of_measurement: "kWh"
        availability: >
          {{ states('sensor.haus_strom_wp_kwh_year') not in ['unknown','unavailable','']
             or states('input_number.haus_strom_wp_vormontage_kwh') not in ['unknown','unavailable',''] }}
        state: >
          {{ ( states('sensor.haus_strom_wp_kwh_year')|float(0)
               + states('input_number.haus_strom_wp_vormontage_kwh')|float(0) ) | round(1) }}
        attributes:
          utm_entity: sensor.haus_strom_wp_kwh_year
          vormontage_kwh: "{{ states('input_number.haus_strom_wp_vormontage_kwh') }}"
