# /config/packages/haus_betriebskosten_2025.yaml
#
# Jahr: 2025
# Zweck: Zentrale Definition der Haus-Betriebskosten (Preise/Grundpreise) und abgeleitete Monatssummen.
# Hinweis: Für monetäre Template-Sensoren ist in HA keine state_class zulässig.
#          Deshalb KEINE `state_class` bei device_class: monetary.
#
input_number:
  # -----------------------------
  # Strom (Hausvertrag, 2025)
  # -----------------------------
  haus_kosten_strom_grundpreis_eur_monat:
    name: "Haus – Kosten: Strom Grundpreis [€/Monat]"
    min: 0
    max: 1000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_strom_arbeitspreis_eur_kwh:
    name: "Haus – Kosten: Strom Arbeitspreis [€/kWh]"
    min: 0
    max: 5
    step: 0.0001
    unit_of_measurement: "€/kWh"
    mode: box

  # -----------------------------
  # Wasser (2025)
  # -----------------------------
  haus_kosten_wasser_grundpreis_eur_monat:
    name: "Haus – Kosten: Wasser Grundpreis [€/Monat]"
    min: 0
    max: 1000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_wasser_arbeitspreis_eur_m3:
    name: "Haus – Kosten: Wasser Arbeitspreis [€/m³]"
    min: 0
    max: 50
    step: 0.0001
    unit_of_measurement: "€/m³"
    mode: box

  # -----------------------------
  # Abwasser (2025)
  # -----------------------------
  haus_kosten_abwasser_grundpreis_eur_monat:
    name: "Haus – Kosten: Abwasser Grundpreis [€/Monat]"
    min: 0
    max: 1000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_abwasser_arbeitspreis_eur_m3:
    name: "Haus – Kosten: Abwasser Arbeitspreis [€/m³]"
    min: 0
    max: 50
    step: 0.0001
    unit_of_measurement: "€/m³"
    mode: box

  # -----------------------------
  # Wärme / Heizung (2025)
  # -----------------------------
  haus_kosten_waerme_arbeitspreis_eur_kwh:
    name: "Haus – Kosten: Wärme Arbeitspreis [€/kWh]"
    min: 0
    max: 2
    step: 0.0001
    unit_of_measurement: "€/kWh"
    mode: box

  # -----------------------------
  # Weitere Fixkosten (2025)
  # -----------------------------
  haus_kosten_muell_eur_monat:
    name: "Haus – Kosten: Müll [€/Monat]"
    min: 0
    max: 1000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_grundsteuer_eur_jahr:
    name: "Haus – Kosten: Grundsteuer [€/Jahr]"
    min: 0
    max: 50000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_gebaeudeversicherung_eur_jahr:
    name: "Haus – Kosten: Gebäudeversicherung [€/Jahr]"
    min: 0
    max: 50000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_wartung_heizung_eur_jahr:
    name: "Haus – Kosten: Wartung Heizung [€/Jahr]"
    min: 0
    max: 50000
    step: 0.01
    unit_of_measurement: "€"
    mode: box
  haus_kosten_schornsteinfeger_eur_jahr:
    name: "Haus – Kosten: Schornsteinfeger [€/Jahr]"
    min: 0
    max: 50000
    step: 0.01
    unit_of_measurement: "€"
    mode: box

template:
  - sensor:
      # Monatsäquivalente aus Jahreskosten (monetär → keine state_class)
      - name: "Haus – Kosten: Grundsteuer [€/Monat]"
        unique_id: haus_kosten_grundsteuer_eur_monat
        unit_of_measurement: "€"
        device_class: monetary
        state: >
          {{ (states('input_number.haus_kosten_grundsteuer_eur_jahr')|float(0) / 12) | round(2) }}
      - name: "Haus – Kosten: Gebäudeversicherung [€/Monat]"
        unique_id: haus_kosten_gebaeudeversicherung_eur_monat
        unit_of_measurement: "€"
        device_class: monetary
        state: >
          {{ (states('input_number.haus_kosten_gebaeudeversicherung_eur_jahr')|float(0) / 12) | round(2) }}
      - name: "Haus – Kosten: Wartung Heizung [€/Monat]"
        unique_id: haus_kosten_wartung_heizung_eur_monat
        unit_of_measurement: "€"
        device_class: monetary
        state: >
          {{ (states('input_number.haus_kosten_wartung_heizung_eur_jahr')|float(0) / 12) | round(2) }}
      - name: "Haus – Kosten: Schornsteinfeger [€/Monat]"
        unique_id: haus_kosten_schornsteinfeger_eur_monat
        unit_of_measurement: "€"
        device_class: monetary
        state: >
          {{ (states('input_number.haus_kosten_schornsteinfeger_eur_jahr')|float(0) / 12) | round(2) }}
      - name: "Haus – Kosten: Strom Grundgebühr je Verteilstelle 2025 [€/Jahr]"
        unique_id: haus_kosten_strom_grundgebuehr_pro_verteilstelle_2025_eur_jahr
        unit_of_measurement: "€"
        device_class: monetary
        state_class: measurement
        state: >
          {% set grund = states('input_number.haus_betriebskosten_strom_grundgebuehr_2025')|float(0) %}
          {% set n = states('input_number.haus_verteilstellen_anzahl')|int(0) %}
          {{ (grund / n) | round(2) if n > 0 else 0 }}
        attributes:
          source_total_eur_monat: "{{ states('input_number.haus_betriebskosten_strom_grundgebuehr_2025') }}"
          verteilstellen_anzahl: "{{ states('input_number.haus_verteilstellen_anzahl') }}"
          
      # Fixkosten-Summe pro Monat (monetär → keine state_class)
      - name: "Haus – Kosten: Fixkosten gesamt [€/Monat]"
        unique_id: haus_kosten_fix_monat_sum_eur
        unit_of_measurement: "€"
        device_class: monetary
        state: >
          {%- set strom_gp   = states('input_number.haus_kosten_strom_grundpreis_eur_monat')|float(0) -%}
          {%- set wasser_gp  = states('input_number.haus_kosten_wasser_grundpreis_eur_monat')|float(0) -%}
          {%- set abw_gp     = states('input_number.haus_kosten_abwasser_grundpreis_eur_monat')|float(0) -%}
          {%- set muell      = states('input_number.haus_kosten_muell_eur_monat')|float(0) -%}
          {%- set grundst    = states('sensor.haus_kosten_grundsteuer_eur_monat')|float(0) -%}
          {%- set versich    = states('sensor.haus_kosten_gebaeudeversicherung_eur_monat')|float(0) -%}
          {%- set wartung    = states('sensor.haus_kosten_wartung_heizung_eur_monat')|float(0) -%}
          {%- set schorni    = states('sensor.haus_kosten_schornsteinfeger_eur_monat')|float(0) -%}
          {{ (strom_gp + wasser_gp + abw_gp + muell + grundst + versich + wartung + schorni) | round(2) }}

      # Sichtbare „Parameter“-Spiegel (monetär → keine state_class)
      - name: "Haus – Parameter: Strom Arbeitspreis [€/kWh]"
        unique_id: haus_param_strom_ap_eur_kwh
        unit_of_measurement: "€/kWh"
        device_class: monetary
        state: "{{ states('input_number.haus_kosten_strom_arbeitspreis_eur_kwh') }}"
      - name: "Haus – Parameter: Wasser Grundpreis [€/Monat]"
        unique_id: haus_param_wasser_gp_eur_monat
        unit_of_measurement: "€"
        device_class: monetary
        state: "{{ states('input_number.haus_kosten_wasser_grundpreis_eur_monat') }}"
      - name: "Haus – Parameter: Wasser Arbeitspreis [€/m³]"
        unique_id: haus_param_wasser_ap_eur_m3
        unit_of_measurement: "€/m³"
        device_class: monetary
        state: "{{ states('input_number.haus_kosten_wasser_arbeitspreis_eur_m3') }}"
      - name: "Haus – Parameter: Abwasser Grundpreis [€/Monat]"
        unique_id: haus_param_abwasser_gp_eur_monat
        unit_of_measurement: "€"
        device_class: monetary
        state: "{{ states('input_number.haus_kosten_abwasser_grundpreis_eur_monat') }}"
      - name: "Haus – Parameter: Abwasser Arbeitspreis [€/m³]"
        unique_id: haus_param_abwasser_ap_eur_m3
        unit_of_measurement: "€/m³"
        device_class: monetary
        state: "{{ states('input_number.haus_kosten_abwasser_arbeitspreis_eur_m3') }}"
      - name: "Haus – Parameter: Wärme Arbeitspreis [€/kWh]"
        unique_id: haus_param_waerme_ap_eur_kwh
        unit_of_measurement: "€/kWh"
        device_class: monetary
        state: "{{ states('input_number.haus_kosten_waerme_arbeitspreis_eur_kwh') }}"
