# /config/packages/31_zaehler_whg01.yaml
# Zähler & Eichfristen – WHG01

input_text:
  whg01_wasser_kalt_meter_id:
    name: "WHG01 – KW: Meter-ID"
    max: 32
  whg01_wasser_kalt_meter_key:
    name: "WHG01 – KW: Meter-Key (HEX)"
    max: 64
  whg01_wasser_kalt_hersteller:
    name: "WHG01 – KW: Hersteller/Typ"
    max: 80
  whg01_wasser_kalt_standort:
    name: "WHG01 – KW: Standort"
    max: 80

  whg01_wasser_warm_meter_id:
    name: "WHG01 – WW: Meter-ID"
    max: 32
  whg01_wasser_warm_meter_key:
    name: "WHG01 – WW: Meter-Key (HEX)"
    max: 64
  whg01_wasser_warm_hersteller:
    name: "WHG01 – WW: Hersteller/Typ"
    max: 80
  whg01_wasser_warm_standort:
    name: "WHG01 – WW: Standort"
    max: 80

  whg01_wmz_meter_id:
    name: "WHG01 – WMZ: Meter-ID"
    max: 32
  whg01_wmz_meter_key:
    name: "WHG01 – WMZ: Meter-Key (HEX)"
    max: 64
  whg01_wmz_hersteller:
    name: "WHG01 – WMZ: Hersteller/Typ"
    max: 80
  whg01_wmz_standort:
    name: "WHG01 – WMZ: Standort"
    max: 80

  whg01_strom_meter_id:
    name: "WHG01 – Strom: Zählernummer/ID"
    max: 32
  whg01_strom_meter_key:
    name: "WHG01 – Strom: Schlüssel (optional)"
    max: 64
  whg01_strom_hersteller:
    name: "WHG01 – Strom: Hersteller/Typ"
    max: 80
  whg01_strom_standort:
    name: "WHG01 – Strom: Standort"
    max: 80

input_number:
  whg01_kw_eichfrist_jahre:
    name: "WHG01 – KW: Eichfrist [Jahre]"
    min: 1
    max: 20
    step: 1
    mode: box
    initial: 6
  whg01_ww_eichfrist_jahre:
    name: "WHG01 – WW: Eichfrist [Jahre]"
    min: 1
    max: 20
    step: 1
    mode: box
    initial: 6
  whg01_wmz_eichfrist_jahre:
    name: "WHG01 – WMZ: Eichfrist [Jahre]"
    min: 1
    max: 20
    step: 1
    mode: box
    initial: 6
  whg01_strom_eichfrist_jahre:
    name: "WHG01 – Strom: Eichfrist [Jahre]"
    min: 1
    max: 20
    step: 1
    mode: box
    initial: 8

input_datetime:
  whg01_wasser_kalt_montage:
    name: "WHG01 – KW: Montage"
    has_date: true
    has_time: false
  whg01_wasser_warm_montage:
    name: "WHG01 – WW: Montage"
    has_date: true
    has_time: false
  whg01_wmz_montage:
    name: "WHG01 – WMZ: Montage"
    has_date: true
    has_time: false
  whg01_strom_montage:
    name: "WHG01 – Strom: Montage"
    has_date: true
    has_time: false

template:
  - sensor:
      - name: whg01_kw_eich_ablauf
        unique_id: whg01_kw_eich_ablauf
        device_class: timestamp
        state: >-
          {% set d = states('input_datetime.whg01_wasser_kalt_montage') %}
          {% set y = states('input_number.whg01_kw_eichfrist_jahre')|int(0) %}
          {% if d not in ['unknown','unavailable',''] and y>0 %}
            {{ (as_datetime(d).date().replace(year=as_datetime(d).year + y)).isoformat() }}
          {% else %} {{ none }} {% endif %}
      - name: whg01_ww_eich_ablauf
        unique_id: whg01_ww_eich_ablauf
        device_class: timestamp
        state: >-
          {% set d = states('input_datetime.whg01_wasser_warm_montage') %}
          {% set y = states('input_number.whg01_ww_eichfrist_jahre')|int(0) %}
          {% if d not in ['unknown','unavailable',''] and y>0 %}
            {{ (as_datetime(d).date().replace(year=as_datetime(d).year + y)).isoformat() }}
          {% else %} {{ none }} {% endif %}
      - name: whg01_wmz_eich_ablauf
        unique_id: whg01_wmz_eich_ablauf
        device_class: timestamp
        state: >-
          {% set d = states('input_datetime.whg01_wmz_montage') %}
          {% set y = states('input_number.whg01_wmz_eichfrist_jahre')|int(0) %}
          {% if d not in ['unknown','unavailable',''] and y>0 %}
            {{ (as_datetime(d).date().replace(year=as_datetime(d).year + y)).isoformat() }}
          {% else %} {{ none }} {% endif %}
      - name: whg01_strom_eich_ablauf
        unique_id: whg01_strom_eich_ablauf
        device_class: timestamp
        state: >-
          {% set d = states('input_datetime.whg01_strom_montage') %}
          {% set y = states('input_number.whg01_strom_eichfrist_jahre')|int(0) %}
          {% if d not in ['unknown','unavailable',''] and y>0 %}
            {{ (as_datetime(d).date().replace(year=as_datetime(d).year + y)).isoformat() }}
          {% else %} {{ none }} {% endif %}
