# WHG01 – Wasser: NUR die laufenden Total-Zähler aus MQTT
mqtt:
  sensor:
    # ---------- KALT ----------
    - object_id: whg01_wasserzaehler_total_m3_kalt
      unique_id: whg01_wasserzaehler_total_m3_kalt
      name: "WHG01 – Wasser KALT: Laufzähler [m³]"
      state_topic: "wmbusmeters/Wasserzaehler_Whg01"
      value_template: >-
        {%- if value_json is defined and value_json is not none -%}
          {%- if value_json.consumption_at_reporting_date_m3 is defined -%}
            {{ value_json.consumption_at_reporting_date_m3 }}
          {%- elif value_json.total_m3 is defined -%}
            {{ value_json.total_m3 }}
          {%- else -%}
            {{ states('sensor.whg01_wasserzaehler_total_m3_kalt') }}
          {%- endif -%}
        {%- elif value is defined and value|regex_match('^\s*\d+[.,]?\d*\s*$', ignorecase=False) -%}
          {{ value|replace(',', '.')|trim }}
        {%- else -%}
          {{ states('sensor.whg01_wasserzaehler_total_m3_kalt') }}
        {%- endif -%}
      unit_of_measurement: "m³"
      device_class: volume
      state_class: total_increasing
      icon: mdi:water

    # ---------- WARM ----------
    - object_id: whg01_wasserzaehler_total_m3_warm
      unique_id: whg01_wasserzaehler_total_m3_warm
      name: "WHG01 – Wasser WARM: Laufzähler [m³]"
      state_topic: "wmbusmeters/Wasserzaehler_Whg01_Warm"
      value_template: >-
        {%- if value_json is defined and value_json is not none -%}
          {%- if value_json.consumption_at_reporting_date_m3 is defined -%}
            {{ value_json.consumption_at_reporting_date_m3 }}
          {%- elif value_json.total_m3 is defined -%}
            {{ value_json.total_m3 }}
          {%- else -%}
            {{ states('sensor.whg01_wasserzaehler_total_m3_warm') }}
          {%- endif -%}
        {%- elif value is defined and value|regex_match('^\s*\d+[.,]?\d*\s*$', ignorecase=False) -%}
          {{ value|replace(',', '.')|trim }}
        {%- else -%}
          {{ states('sensor.whg01_wasserzaehler_total_m3_warm') }}
        {%- endif -%}
      unit_of_measurement: "m³"
      device_class: volume
      state_class: total_increasing
      icon: mdi:water
