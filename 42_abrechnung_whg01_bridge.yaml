# WHG01 – Abrechnungs-Bridge (nur Vormontage + Gesamtstände, kollisionsfrei)

input_number:
  whg01_wasser_kalt_vormontage_m3:
    name: "WHG01 Wasser KALT Vormontage [m³]"
    min: 0
    max: 100000
    step: 0.001
    mode: box
    unit_of_measurement: "m³"
    icon: mdi:water
    initial: 0

  whg01_wasser_warm_vormontage_m3:
    name: "WHG01 Wasser WARM Vormontage [m³]"
    min: 0
    max: 100000
    step: 0.001
    mode: box
    unit_of_measurement: "m³"
    icon: mdi:water-thermometer
    initial: 0

template:
  - sensor:
      # ---------- KALT: Gesamt = Vormontage + laufender Zähler ----------
      - name: "whg01_wasser_kalt_m3_gesamt"
        unique_id: whg01_wasser_kalt_m3_gesamt
        unit_of_measurement: "m³"
        device_class: volume
        state_class: total_increasing
        icon: mdi:water
        state: >-
          {% set base  = states('input_number.whg01_wasser_kalt_vormontage_m3') | replace(',', '.') | float(0) %}
          {% set total = states('sensor.whg01_wasserzaehler_total_m3_kalt')     | replace(',', '.') | float(0) %}
          {{ (base + total) | round(3) }}

      # ---------- WARM: Gesamt = Vormontage + laufender Zähler ----------
      - name: "whg01_wasser_warm_m3_gesamt"
        unique_id: whg01_wasser_warm_m3_gesamt
        unit_of_measurement: "m³"
        device_class: volume
        state_class: total_increasing
        icon: mdi:water-thermometer
        state: >-
          {% set base  = states('input_number.whg01_wasser_warm_vormontage_m3') | replace(',', '.') | float(0) %}
          {% set total = states('sensor.whg01_wasserzaehler_total_m3_warm')     | replace(',', '.') | float(0) %}
          {{ (base + total) | round(3) }}
